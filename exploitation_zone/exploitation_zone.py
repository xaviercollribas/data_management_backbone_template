import psycopg2
import pandas as pd
from airflow.models import Variable


# PostgreSQL database connection settings
exploitation_zone_settings = {
    "dbname": Variable.get("ez_dbname"),
    "user": Variable.get("dbuser"),
    "password": Variable.get("exploitation_zone_secret"),
    "host": Variable.get("dbhost"),
}

def load_table_into_dataframe(db_settings, table_name):
    conn = psycopg2.connect(**db_settings)

    try:
        # Load table data into a Pandas DataFrame
        query = f"SELECT * FROM \"{table_name}\""
        df = pd.read_sql_query(query, conn)
        return df
    finally:
        conn.close()

def main():
    table_name = "your_table_name"  # Replace with the name of the table you want to load
    df = load_table_into_dataframe(exploitation_zone_settings, table_name)

    print(df.head())  

if __name__ == "__main__":
    main()
